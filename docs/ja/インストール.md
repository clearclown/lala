# インストールガイド

このガイドでは、Lalaエディタをさまざまな環境にインストールする方法を説明します。

## 目次

- [システム要件](#システム要件)
- [パッケージマネージャーからのインストール](#パッケージマネージャーからのインストール)
  - [Rust/Cargo](#rustcargo)
  - [Linux (Debian/Ubuntu)](#linux-debianubuntu)
  - [Linux (Arch)](#linux-arch)
  - [Linux (Fedora/RHEL)](#linux-fedorarhel)
  - [macOS (Homebrew)](#macos-homebrew)
  - [Windows (Chocolatey)](#windows-chocolatey)
  - [Windows (Scoop)](#windows-scoop)
- [手動インストール](#手動インストール)
- [ソースからのビルド](#ソースからのビルド)
- [インストールの確認](#インストールの確認)
- [トラブルシューティング](#トラブルシューティング)

## システム要件

### 最小要件

- **オペレーティングシステム**: Linux、macOS 10.12+、Windows 10+
- **メモリ**: 256 MB RAM
- **ディスク容量**: 50 MB の空き容量

### 推奨要件

- **メモリ**: 512 MB RAM 以上
- **ディスク容量**: 100 MB の空き容量

### ソースからビルドする場合

- **Rust**: 1.70 以上
- **Cargo**: 最新版
- **システムライブラリ**:
  - Linux: `libxcb-dev`, `pkg-config`, `libssl-dev`
  - macOS: Xcode コマンドラインツール
  - Windows: Visual Studio Build Tools または MinGW

## パッケージマネージャーからのインストール

### Rust/Cargo

**すべてのプラットフォームで推奨される方法です。**

Rustがインストールされていない場合は、まず[rustup](https://rustup.rs/)でインストールしてください：

```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```

次に、Lalaをインストールします：

```bash
cargo install lala
```

#### 利点

- 最新版を即座に入手できる
- すべてのプラットフォームで同じ方法
- 自動的に依存関係を解決

#### 更新方法

```bash
cargo install lala --force
```

### Linux (Debian/Ubuntu)

#### APTリポジトリから

```bash
# リポジトリを追加（初回のみ）
curl -fsSL https://yourusername.github.io/lala/KEY.gpg | sudo gpg --dearmor -o /usr/share/keyrings/lala-archive-keyring.gpg
echo "deb [signed-by=/usr/share/keyrings/lala-archive-keyring.gpg] https://yourusername.github.io/lala/apt stable main" | sudo tee /etc/apt/sources.list.d/lala.list

# インストール
sudo apt update
sudo apt install lala
```

#### .debパッケージから

```bash
# 最新のリリースをダウンロード
wget https://github.com/yourusername/lala/releases/latest/download/lala-linux-x86_64.deb

# インストール
sudo dpkg -i lala-linux-x86_64.deb

# 依存関係がない場合は解決
sudo apt-get install -f
```

#### 更新方法

```bash
sudo apt update
sudo apt upgrade lala
```

### Linux (Arch)

#### AURから

yayを使用する場合：

```bash
yay -S lala
```

paruを使用する場合：

```bash
paru -S lala
```

#### 更新方法

```bash
yay -Syu lala
# または
paru -Syu lala
```

### Linux (Fedora/RHEL)

#### DNFリポジトリから

```bash
# リポジトリを追加（初回のみ）
sudo dnf config-manager --add-repo https://yourusername.github.io/lala/rpm/lala.repo

# インストール
sudo dnf install lala
```

#### RPMパッケージから

```bash
# 最新のリリースをダウンロード
wget https://github.com/yourusername/lala/releases/latest/download/lala-0.1.0-1.x86_64.rpm

# インストール
sudo dnf install ./lala-0.1.0-1.x86_64.rpm
```

#### 更新方法

```bash
sudo dnf update lala
```

### macOS (Homebrew)

#### インストール

```bash
brew install lala
```

#### 更新方法

```bash
brew upgrade lala
```

### Windows (Chocolatey)

#### インストール

管理者権限のPowerShellで実行：

```powershell
choco install lala
```

#### 更新方法

```powershell
choco upgrade lala
```

### Windows (Scoop)

#### インストール

```powershell
scoop install lala
```

#### 更新方法

```powershell
scoop update lala
```

## 手動インストール

### Linux/macOS

#### ユニバーサルインストールスクリプト

このスクリプトは自動的にプラットフォームを検出してインストールします：

```bash
curl -sSL https://raw.githubusercontent.com/yourusername/lala/main/packaging/scripts/install.sh | bash
```

カスタムインストール先を指定する場合：

```bash
INSTALL_DIR=/usr/local/bin curl -sSL https://raw.githubusercontent.com/yourusername/lala/main/packaging/scripts/install.sh | bash
```

特定のバージョンをインストールする場合：

```bash
VERSION=0.1.0 curl -sSL https://raw.githubusercontent.com/yourusername/lala/main/packaging/scripts/install.sh | bash
```

#### バイナリの直接ダウンロード

1. [リリースページ](https://github.com/yourusername/lala/releases)から適切なバイナリをダウンロード
2. アーカイブを展開
3. 実行ファイルを適切な場所に移動

例（Linux x86_64）：

```bash
# ダウンロード
wget https://github.com/yourusername/lala/releases/latest/download/lala-linux-x86_64.tar.gz

# 展開
tar xzf lala-linux-x86_64.tar.gz

# インストール
sudo mv lala /usr/local/bin/

# 実行権限を付与
sudo chmod +x /usr/local/bin/lala
```

### Windows

#### インストーラー

1. [リリースページ](https://github.com/yourusername/lala/releases)から`lala-installer-*.exe`をダウンロード
2. インストーラーを実行
3. ウィザードの指示に従う

インストーラーは自動的に：
- プログラムファイルにインストール
- PATHに追加
- スタートメニューにショートカットを作成
- アンインストーラーを作成

#### ポータブル版

1. [リリースページ](https://github.com/yourusername/lala/releases)から`lala-windows-x86_64.zip`をダウンロード
2. 任意のフォルダに展開
3. 必要に応じて手動でPATHに追加

## ソースからのビルド

### 前提条件のインストール

#### Linux (Debian/Ubuntu)

```bash
sudo apt install build-essential pkg-config libssl-dev libxcb-dev
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```

#### Linux (Fedora/RHEL)

```bash
sudo dnf install gcc pkg-config openssl-devel libxcb-devel
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```

#### macOS

```bash
xcode-select --install
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```

#### Windows

1. [Visual Studio Build Tools](https://visualstudio.microsoft.com/downloads/)をインストール
2. [rustup](https://rustup.rs/)をインストール

### ビルド手順

```bash
# リポジトリをクローン
git clone https://github.com/yourusername/lala.git
cd lala

# リリースビルド
cargo build --release

# テストの実行
cargo test

# ローカルインストール
cargo install --path .
```

ビルドされたバイナリは`target/release/lala`にあります。

### ビルドオプション

#### 機能フラグ

```bash
# すべての機能を有効化
cargo build --release --all-features

# 特定の機能のみ
cargo build --release --features "cli,gui"

# GUIなし（CLIのみ）
cargo build --release --no-default-features --features "cli"
```

#### 最適化

より小さいバイナリサイズを得るには：

```bash
# Cargo.tomlに以下を追加
[profile.release]
opt-level = "z"
lto = true
codegen-units = 1
strip = true
```

## インストールの確認

インストールが成功したことを確認するには：

```bash
# バージョンを確認
lala --version

# ヘルプを表示
lala --help

# 簡単なテスト
echo "# テスト" > test.md
lala preview test.md
```

正常に動作すれば、Markdownがカラー出力で表示されます。

## トラブルシューティング

### コマンドが見つからない

**問題**: `lala: command not found`

**解決方法**:

1. インストール先がPATHに含まれていることを確認：

```bash
echo $PATH
```

2. Cargoでインストールした場合、`~/.cargo/bin`がPATHにあることを確認：

```bash
# bashの場合（~/.bashrcに追加）
export PATH="$HOME/.cargo/bin:$PATH"

# zshの場合（~/.zshrcに追加）
export PATH="$HOME/.cargo/bin:$PATH"

# fishの場合（~/.config/fish/config.fishに追加）
set -gx PATH $HOME/.cargo/bin $PATH
```

3. シェルを再起動または設定をリロード：

```bash
source ~/.bashrc  # または ~/.zshrc
```

### 依存関係エラー (Linux)

**問題**: ビルド時に`libxcb`関連のエラー

**解決方法**:

```bash
# Debian/Ubuntu
sudo apt install libxcb-shape0-dev libxcb-xfixes0-dev

# Fedora
sudo dnf install libxcb-devel
```

### 権限エラー

**問題**: インストール時に権限が拒否される

**解決方法**:

```bash
# ユーザーローカルにインストール
cargo install --path . --root ~/.local

# または sudoを使用（システムワイド）
sudo cargo install --path . --root /usr/local
```

### Windows: Visual C++ランタイムエラー

**問題**: `VCRUNTIME140.dll`が見つからない

**解決方法**:

[Visual C++ Redistributable](https://aka.ms/vs/17/release/vc_redist.x64.exe)をインストール

### macOS: セキュリティ警告

**問題**: 「開発元を確認できないため開けません」

**解決方法**:

```bash
xattr -cr /usr/local/bin/lala
```

またはシステム環境設定 > セキュリティとプライバシーで許可する。

### 更新に失敗する

**問題**: パッケージマネージャーでの更新が失敗

**解決方法**:

1. キャッシュをクリア：

```bash
# APT
sudo apt clean
sudo apt update

# DNF
sudo dnf clean all

# Homebrew
brew cleanup
brew update

# Cargo
cargo clean
```

2. 手動で再インストール：

```bash
# 既存のインストールを削除
cargo uninstall lala

# 再インストール
cargo install lala
```

## アンインストール

### Cargo

```bash
cargo uninstall lala
```

### APT (Debian/Ubuntu)

```bash
sudo apt remove lala
# または完全削除
sudo apt purge lala
```

### DNF (Fedora/RHEL)

```bash
sudo dnf remove lala
```

### Homebrew (macOS)

```bash
brew uninstall lala
```

### Chocolatey (Windows)

```powershell
choco uninstall lala
```

### Scoop (Windows)

```powershell
scoop uninstall lala
```

### 手動インストールの場合

```bash
# バイナリを削除
sudo rm /usr/local/bin/lala

# 設定ファイルも削除する場合
rm -rf ~/.config/lala
```

---

インストールに関する問題が解決しない場合は、[Issue](https://github.com/yourusername/lala/issues)を作成してください。
